// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL") // connection DB
}

//Modèle FAMILLE 
model Famille {
  id                String      @id @db.VarChar(10)
  libelle           String      @db.VarChar(80)
  medicaments       Medicament[]        // relation avec le modèle MEDICAMENTS => tout les medicaments d'une famille
}

//Modèle MEDECINS
model Medecin {
  id                         Int         @id @default(autoincrement()) 
  nom                        String      @db.VarChar(30)
  prenom                     String      @db.VarChar(30)
  adresse                    String      @db.VarChar(80)
  tel                        String      @db.VarChar(15)
  specialitecomplementaire   String      @db.VarChar(50)
  departement                Int         
  rapport                    Rapport[]           // relation avec le modèle RAPPORT => tout les rapports relié à un médecin
}

//Modèle MEDICAMENTS
model Medicament {
  id                    String      @id @db.VarChar(30)
  nomCommercial         String      @db.VarChar(80)
  idfamille             String      @db.VarChar(10) // clé étrangère vers la famille
  composition           String      @db.VarChar(100)
  effets                String      @db.VarChar(100)
  contreindications     String      @db.VarChar(100)

  famille               Famille    @relation(fields: [idfamille], references: [id]) // relation avec le modèle FAMILLE => une famille peut avoir plusieurs medicaments
  offerts               Offrir[]            // relation avec le modèle OFFRIR => tout les apparitions d'un medicament dans des offres
}

//Modèle VISITEUR
model Visiteur {
  id                   Int          @id @default(autoincrement())
  nom                  String?      @db.VarChar(30)
  prenom               String?      @db.VarChar(30)
  login                String?      @db.VarChar(20)
  mdp                  String?      @db.VarChar(20)
  adresse              String?      @db.VarChar(30)
  cp                   String?      @db.VarChar(5)
  ville                String?      @db.VarChar(30)
  dateembauche         DateTime?
  timespan             Int
  ticket               String?      @db.VarChar(50)

  rapport             Rapport[]     // relation avec le modèle RAPPORT => tout les rapports relié à un visiteur
}

//Modèle RAPPORT
model Rapport {
  id                   Int         @id @default(autoincrement())
  date                 DateTime?
  motif                String?      @db.VarChar(100)
  bilan                String?      @db.VarChar(100)
  idvisiteur           Int          // clé étrangère vers visiteur
  idmedecin            Int          // clé étrangère vers medecin

  visiteur             Visiteur     @relation(fields: [idvisiteur], references: [id]) // relation avec le modèle VISITEUR => un visiteur peut avoir plusieurs rapports
  medecin              Medecin      @relation(fields: [idmedecin], references: [id]) // relation avec le modèle MEDECIN => un médecin peut avoir plusieurs rapports
  offrir                Offrir[]     // relation avec le modèle OFFRIR => tout les offres relié à un rapport
}

//Modèle OFFRIR
model Offrir {
  idrapport             Int         @id @default(autoincrement()) // clé étrangère vers rapport
  idmedicament          String      @db.VarChar(30) // clé étrangère vers medicament
  quantite              Int

  rapport                Rapport          @relation(fields: [idrapport], references: [id]) // relation avec le modèle RAPPORT => un rapport peut etre relié à plusieurs offres
  medicament             Medicament       @relation(fields: [idmedicament] , references: [id])  // relation avec le modèle MEDICAMENTS => un medicament peut etre relié à plusieurs offres
}
